Утилита `cron` хорошо подходит для повторяющихся задач, которые выполняются каждые несколько минут/часов или в определенные дни. Также она позволяет задать определенное точное время, в которое должна запуститься задача.

Утилита `anacron` также подходит для повторяющихся задач, но она НЕ может исполнять их каждые несколько минут/часов. Минимальная единица времени, с которой работает `anacron` - это день. Соответственно утилита может запускать задачи каждый день, каждые несколько дней, каждую неделю, каждый месяц и т.д.

`cron` может пропустить выполнение задачи. Например, если сервер находился в выключенном состоянии и затем включен в 00:05, а выполнение задачи было запланировано на 00:01, то задача не будет выполнена cron-ом в этот день. `anacron` в свою очередь выполнит задачу как только сервер будет включен.

| Cron | Anacron |
| ----------- | ----------- |
| Является службой | НЕ является службой |
| Подходит для серверов | Подходит для ПК и ноутбуков |
| Позволяет запускать запланированные задания каждую минуту | Позволяет запускать запланированные задания только на ежедневной основе |
| Если машина выключена, запланированное задание НЕ выполнится | Если машина выключена, выполнит запланированное задание при следующем включении машины |
| Может использоваться как локальными пользователями, так и суперпользователем root | Может использоваться только суперпользователем root, если не указано иное (включено для обычных пользователей с конкретными настройками) |

---

Основное различие между `cron` и `anacron` заключается в том, что `cron` эффективно работает на машинах, которые будут работать непрерывно, в то время как `anacron` предназначен для машин, которые периодически могут выключаться.

Утилита `at` подходит для одноразового запуска задач.

Установка демона crond: `yum install -y cronie`.

Из файла `/etc/crontab ` можно взять синтаксис `anacron`. Это system-wide cron table, поэтому не нужно вносить изменения напрямую в этот файл.

```
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  * user-name command to be executed

35 6 * * * root /bin/some_command --some_options
```

Указывается полный путь к исполняемому файлу, который можно узнать с помощью команды `which`.

- `*` - match all possible values, every hour
- `,` - match multiple values, `15,30`
- `-` - range of values, `2-4`
- `/` - specifies steps, `*/4`

Можно комбинировать указанные выше опции, например `0-8/4`.

Редактировать cron table текущего пользователя: `crontab -e`.

Например: `35 6 * * * /usr/bin/touch test_passed`. Здесь имя пользователя можно не указывать, т.к. мы редактируем пользовательский cron table и `cron` знает под каким пользователем будет выполняться команда.

Смотреть cron table текущего пользователя: `crontab -l`.

Смотреть cron table для root-a: `sudo crontab -l`.

Редактировать cron table пользователя jane: `sudo crontab -e -u jane`. Здесь `u = user`.

Удалить cron table для текущего пользователя: `crontab -r`. Здесь `r = remove`.

Удалить cron table пользователя jane: `crontab -r -u jane`.

Существует несколько директорий для размещения `cron` задач:

- `/etc/cron.daily` - выполняются каждый день
- `/etc/cron.hourly` - выполняются каждый час
- `/etc/cron.monthly` - выполняются каждый месяц
- `/etc/cron.weekly` - выполняются каждую неделю

Предположим, что нам нужно запускать скрипт с помощью `cron`.

Первое - скрипт не должен иметь `.sh` в названии.

Копируем скрипт в соответствующую директорию из списка выше: `sudo cp shellscript /etc/cron.hourly/`.

Даем ему права на чтение/исполнение: `sudo chmod +rx /etc/cron.hourly/shellscript`.

09:04

# чтобы ограничить доступ к выполнению crontab определенным пользователям создаем файл /etc/cron.deny и добавляем туда их логины в столбик
# чтобы разрешить доступ к выполнению crontab определенным пользователям создаем файл /etc/cron.allow и добавляем туда их логины в столбик

sudo vim /etc/anacrontab   #файл для задания anacron-jobs
sudo anacron -n   #n=now, запустить все запланированные джобы прямо сейчас, если джоба уже запускалась сегодня, то повторно она не запустится
sudo anacron -n -f   #f=force, запустить все запланированные джобы принудительно прямо сейчас, даже если джоба уже запускалась сегодня
# 3 (каждые три дня, можно указать например @weekly, @monthly)   10 (задержка перед запуском джобы в минутах, т.к. если на этот день запланирован запуск 15 джобов,
# и сервер был выключен и затем включился, чтобы они не запустились все разом и не создали высокую нагрузку на систему)   
# job_name (произвольное имя джобы, котороое мы увидим в логах)   /usr/bin/touch /root/anacron_created_this (необходимое действие, команда)
anacron -T   #протестировать синтаксис анакрон
at 15:00 или 
at 'August 20 2022' или 
at '2:30 August 20 2022' или
at 'now + 30 minutes' или
at 'now + 3 hours'   #через три часа от текущего момента, или
at 'now + 3 days'    
at 'now + 3 weeks'
at 'now + 3 months'   
at> /usr/bin/touch file_created_by_at   #создание джобы с помощью at, выйти Ctrl+D
atq   #смотреть запланированные джобы, отсюда берем id джобы
at -c 20   #c=cat, смотреть детально свойства джобы номер 20
atrm 20   #удалить джобу с номером 20


0 4 * * * sudo sh /opt/script.sh   #для выполнения скриптов необходимо указать команду sh
0 4 * * 1 /usr/local/bin/script1.sh   #каждый понедельник в 04:00 AM
30 4 1 * * /usr/local/bin/script2.sh   #каждое первое число месяца в 04:30 AM
0 1,2,3 * * * /usr/local/bin/script3.sh   #каждый день в 01:00, 02:00, 03:00 AM