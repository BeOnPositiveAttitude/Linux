Для мониторинга производительности дисковой подсистемы нам понадобятся утилиты `iostat` и `pidstat`.

Они входят в состав пакета `sysstat`. Установим его: `sudo apt install sysstat`.

Рассмотрим вывод команды `iostat`.

<img src="image.png" width="700" height="300"><br>

Важно понимать, что утилита показывает "исторические" данные с момента последней загрузки системы. Т.е. любая представленная метрика рассчитывается как среднее значение. Например `kB_reads/s` - это общее количество "прочитанных" килобайт поделенное на время uptime сервера.

Предположим мы испытываем проблемы с дисковой подсистемой в течение последнего часа, а сервер работает уже две недели. Соответственно мы не увидим каких-либо значений, отражающих проблему. Т.к. это будет среднее значение с момента загрузки сервера до момент ввода команды.

Например сервер работает всего три секунды. Пример расчета метрики (значения представлены в виде "килобайт в секунду"):

<img src="image-1.png" width="700" height="200"><br>

Метрика `tps` (transfers per second) - сколько раз система сообщила устройству прочитать или записать что-либо.

<img src="image-2.png" width="700" height="200"><br>

Однако, если мы испытываем проблемы с дисковой подсистемой прямо сейчас, то можно посмотреть статистику например за последние 10 секунд: `iostat 10`. При этом значения будут обновляться каждые 10 секунд.

Можно убрать из вывода команды статистику по CPU: `iostat -d`.

Для удобства отображения единиц измерений можно использовать флаг: `iostat -h`.

Для отображения статистики по всем разделам дисков: `iostat -p ALL`.

Для отображения статистики по разделам определенного диска: `iostat -p sda`.

Создать искусственную нагрузку на storage можно командой: `dd if=/dev/zero of=DELETEME bs=1 count=1000000 oflag=dsync &`.

Как нам узнать какой процесс активно использует дисковую подсистему?

Воспользуемся командой `pidstat -d --human 1`. Флаг `-d` отражает статистику I/O, `--human` для удобства отображения единиц измерений, цифра 1 означает обновлять каждую секунду.

Предположим мы увидели из вывода этой команды, что процесс c PID=2988 активно пишет на диск.

Смотрим, что это за процесс командой: `ps 2988`.